<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Background (AI) - Tulz.net</title>
    <meta name="description"
        content="Remove image backgrounds instantly using AI. Setup your own API key for unlimited control.">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <header>
        <div class="container">
            <nav>
                <a href="../index.html" class="logo">Tulz.net</a>
                <div class="nav-links">
                    <a href="../index.html">Home</a>
                    <a href="../index.html#image-tools">Image Tools</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="tool-container">
            <h1>Remove Background (AI)</h1>
            <p class="text-muted">Use your own Remove.bg API Key to process images without leaving this site.</p>

            <!-- API Key Setup -->
            <div id="key-setup"
                style="background: #fff3cd; padding: 1rem; border-radius: 0.5rem; border: 1px solid #ffeeba; margin-bottom: 2rem;">
                <label style="display:block; margin-bottom:0.5rem;">Enter Remove.bg API Key</label>
                <div style="display:flex; gap:0.5rem;">
                    <input type="password" id="api-key" placeholder="Get key from remove.bg/api">
                    <button class="btn" onclick="saveKey()">Save Key</button>
                </div>
                <p style="font-size:0.8rem; margin-top:0.5rem;">Key is stored locally in your browser. We never see it.
                </p>
            </div>

            <!-- Upload Area -->
            <div id="drop-zone" class="upload-zone" style="display:none;">
                <div class="tool-icon">ü™Ñ</div>
                <h3>Upload Image</h3>
                <input type="file" id="file-input" accept="image/*" style="display: none;">
                <button class="btn btn-secondary" onclick="document.getElementById('file-input').click()">Select
                    File</button>
            </div>

            <div id="result-stage" style="display: none; text-align: center;">
                <h3>Result</h3>
                <img id="result-img"
                    style="max-width: 100%; border-radius: 0.5rem; box-shadow: var(--shadow); margin: 1rem 0;">
                <br>
                <a id="download-link" class="btn">Download HD Image</a>
                <button class="btn btn-secondary" onclick="location.reload()">Process Another</button>
            </div>

            <div id="loading" style="display:none; text-align:center; padding:2rem;">
                <div style="font-size:2rem;">‚è≥</div>
                <p>Removing background...</p>
            </div>
        </div>
    </main>

    <script src="../js/main.js"></script>
    <script>
        const keyInput = document.getElementById('api-key');
        const dropZone = document.getElementById('drop-zone');

        // Load saved key
        const savedKey = localStorage.getItem('remove_bg_key');
        if (savedKey) {
            keyInput.value = savedKey;
            dropZone.style.display = 'block';
            document.getElementById('key-setup').style.display = 'none'; // Hide setup if key exists
        } else {
            dropZone.style.display = 'none';
        }

        function saveKey() {
            const key = keyInput.value.trim();
            if (key) {
                localStorage.setItem('remove_bg_key', key);
                location.reload();
            }
        }

        document.getElementById('file-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const apiKey = localStorage.getItem('remove_bg_key');
            if (!apiKey) return alert("Please save API Key first.");

            dropZone.style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            const formData = new FormData();
            formData.append('image_file', file);
            formData.append('size', 'auto');

            try {
                const response = await fetch('https://api.remove.bg/v1.0/removebg', {
                    method: 'POST',
                    headers: { 'X-Api-Key': apiKey },
                    body: formData
                });

                if (!response.ok) throw new Error("API Error: " + response.statusText);

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);

                document.getElementById('result-img').src = url;
                document.getElementById('download-link').href = url;
                document.getElementById('download-link').download = 'no-bg-' + file.name;

                document.getElementById('loading').style.display = 'none';
                document.getElementById('result-stage').style.display = 'block';

            } catch (err) {
                alert(err.message);
                location.reload();
            }
        });
    </script>
</body>

</html>